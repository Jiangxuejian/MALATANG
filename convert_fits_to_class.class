! ------ Aim: convert all fits files (for each subscan and each receptor) into a single file in CLASS format. 
! --     These fits files are produced by convert_JCMT_fits.py 
! --     pmozhang@gmail.com 
! --     last update: 01 Nov 2016  
!        useage: 
!         
!        @ convert_fits_to_class.class output_name  !(without .jcmt)

! --     TODO: read a tale file for the size (subscan numbers and receptor numbers)
!              read the central position 

define char   outputname*128 
define double l  b   lref bref          ! lambda and beta 

define integ subscan_num receptor_num 

let outputname &1
sic dele 'outputname'.jcmt 
file out 'outputname'.jcmt s
column x 1 /file numbers.dat
let subscan_num  x[1]
let receptor_num x[2]


fits read test_scan0_rec0.fits 
let lref lambda 
let bref beta


for i 0 to subscan_num-1
    for j 0 to receptor_num-1 
        fits read test_scan'i'_rec'j'.fits 
        let l     lref*12./pi
        let b     bref*180./pi
        modi position  l b 
        write i*14+j+1
    next 
next

sic dele test_*.fits 
sic dele numbers.dat 

